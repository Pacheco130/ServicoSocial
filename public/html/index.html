<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>IPN - CONTROL DE ASISTENCIA</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        #mensaje-flotante {
            display: none;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #4caf50;
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 9999;
        }
    </style>
</head>
<body> 
    <header>
        <h1>CONTROL DE ASISTENCIA</h1>
        <img src="/img/CECyt19.png" alt="Logo Izquierdo" class="corner-image left">
        <img src="/img/IPN.png" alt="Logo Derecho" class="corner-image right">
    </header>
    <form id="pdfForm" method="POST" action="/generate-pdf">
        <div class="form-group">
            <label for="reporteNo">Correspondiente al reporte mensual de actividades No.:</label>
            <select id="reporteNo" name="reporteNo" required>
                <option value="">Seleccione...</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="registro">No. de Registro:</label>
            <input type="text" id="registro" name="registro" required>
        </div>
        
        <div class="form-group">
            <label for="boleta">Boleta:</label>
            <input type="text" id="boleta" name="boleta" required>
        </div>
        
        <div class="form-group">
            <label for="nombre">Nombre del Prestador:</label>
            <input type="text" id="nombre" name="nombre" required>
        </div>
        
        <div class="form-group">
            <label for="unidadAcademica">Unidad Académica:</label>
            <input type="text" id="unidadAcademica" name="unidadAcademica" required>
        </div>
        
        <div class="form-group">
            <label for="carrera">Carrera:</label>
            <select id="carrera" name="carrera" required>
                <option value="">Seleccione...</option>
                <option value="Tecnico en Aeronáutica">Técnico en Aeronáutica</option>
                <option value="Tecnico en Alimentos">Técnico en Alimentos</option>
                <option value="Tecnico en Construccion">Técnico en Construcción</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="responsableNombre">Nombre del Responsable:</label>
            <input type="text" id="responsableNombre" name="responsableNombre" required>
        </div>
        
        <div class="form-group">
            <label for="responsableCargo">Cargo del Responsable:</label>
            <input type="text" id="responsableCargo" name="responsableCargo" required>
        </div>
        
        <div class="form-group">
            <label for="horaEntrada">Hora de entrada:</label>
            <input type="time" id="horaEntrada" name="horaEntrada" required>
        </div>
        <div class="form-group">
            <label for="horaSalida">Hora de salida:</label>
            <input type="time" id="horaSalida" name="horaSalida" required disabled>
        </div>
        
        <button type="submit">Descargar</button>
    </form>
    <div id="mensaje-flotante">Descargando PDF...</div>
    <script src="../js/script.js"></script>
    <script>
        const horaEntrada = document.getElementById('horaEntrada');
        const horaSalida = document.getElementById('horaSalida');
        horaEntrada.addEventListener('change', function() {
            if (horaEntrada.value) {
                horaSalida.disabled = false;
                horaSalida.min = horaEntrada.value;
                // Calcular máximo permitido (4 horas después)
                let [h, m] = horaEntrada.value.split(':').map(Number);
                let salidaH = h + 4;
                if (salidaH > 23) salidaH = 23;
                const salidaAuto = salidaH.toString().padStart(2, '0') + ':' + m.toString().padStart(2, '0');
                horaSalida.value = salidaAuto;
                horaSalida.max = salidaAuto;
            } else {
                horaSalida.value = '';
                horaSalida.disabled = true;
            }
        });
        horaSalida.addEventListener('input', function() {
            if (horaEntrada.value && horaSalida.value) {
                // Validar que no exceda 4 horas
                let [h1, m1] = horaEntrada.value.split(':').map(Number);
                let [h2, m2] = horaSalida.value.split(':').map(Number);
                let diff = (h2*60 + m2) - (h1*60 + m1);
                if (diff > 240) {
                    alert('La diferencia no puede ser mayor a 4 horas');
                    horaSalida.value = '';
                }
            }
        });
        document.getElementById('pdfForm').addEventListener('submit', function(e) {
            const reporteNo = document.getElementById('reporteNo').value;
            // Mostrar mensaje flotante
            const mensaje = document.getElementById('mensaje-flotante');
            mensaje.style.display = 'block';
            setTimeout(() => { mensaje.style.display = 'none'; }, 3000);
        });
    </script>
</body>
</html>